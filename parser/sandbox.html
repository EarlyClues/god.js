<html>
<head>
  <title>God Test</title>
  <script type="text/javascript" src="peg.js"></script>
  <script type="text/javascript">
  // http://tech.karbassi.com/2009/12/17/pure-javascript-flatten-array/
  Array.prototype.flatten = function flatten(){
     var flat = [];
     for (var i = 0, l = this.length; i < l; i++){
         var type = Object.prototype.toString.call(this[i]).split(' ').pop().split(']').shift().toLowerCase();
         if (type) { flat = flat.concat(/^(array|collection|arguments|object)$/.test(type) ? flatten.call(this[i]) : this[i]); }
     }
     return flat;
  };

  // http://stackoverflow.com/questions/281264/remove-empty-elements-from-an-array-in-javascript
  Array.prototype.clean = function(deleteValue) {
    for (var i = 0; i < this.length; i++) {
      if (this[i] == deleteValue) {         
        this.splice(i, 1);
        i--;
      }
    }
    return this;
  };

  var God = {
    parser: PEG.buildParser("\
      start = s:sentence* { return s.join('') } \
      \
      sentence = scriptofjava / bullshit \
      scriptofjava = white? 'as it was said in the script of java 'i code:notamen+ amen punctuation  { return code.join(' ') + ';' } \
      bullshit = white? words:word+ punctuation { return '// ' + words.join(' ') + '\\n' } \
      \
      string = string_spaces / string_spaceless
      string_spaces = ('the'i white)? 'verse'i white s:notamen+ amen { return '\"' + s.join(' ') + '\"' } \
      string_spaceless = ('the'i white)? 'word'i white w:[^ ]+ { return '\"' + w.join('') + '\"' } \
      \
      amen = 'amen'i { return ';' } \
      notamen = !amen w:[^ ]+ white { return w.join('') } \
      \
      punctuation = '.' / '?' / '!' / ',' \
      word = !amen white? w:[a-zA-Z]+ white? { return w.join('') } \
      \
      white = ' '+ \
      ")
  }
  </script>
</head>
<body>
</body>
</html>